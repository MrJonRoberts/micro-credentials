{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center">
    <h1>Icons</h1>
    <a href="{{ url_for('icons.create') }}" class="btn btn-primary">
      <i class="fa fa-plus"></i> New Icon
    </a>
  </div>

  <form class="row g-2 mt-3 align-items-end" method="get" action="{{ url_for('icons.index') }}">
    <div class="col-md-4">
      <label class="form-label">Search</label>
      <input type="text" class="form-control" name="q" value="{{ q }}" placeholder="Search by name">
    </div>
    <div class="col-md-4">
      <label class="form-label">Category</label>
      <select class="form-select" name="category">
        <option value="">All categories</option>
        {% for c in categories %}
          <option value="{{ c }}" {% if category==c %}selected{% endif %}>{{ c }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-2">
      <label class="form-label">Per page</label>
      <select class="form-select" name="per_page">
        {% for n in [12,24,36,48,72,96] %}
          <option value="{{ n }}" {% if per_page==n %}selected{% endif %}>{{ n }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-2">
      <button class="btn btn-secondary w-100" type="submit">
        <i class="fa fa-search"></i> Apply
      </button>
    </div>
  </form>

  <div class="mt-2 text-muted small">
    {% set start = (pagination.page - 1) * pagination.per_page + 1 if pagination.total else 0 %}
    {% set end = (pagination.page - 1) * pagination.per_page + icons|length %}
    Showing {{ start }}–{{ end }} of {{ pagination.total }}
  </div>

  <table class="table table-striped table-hover mt-3">
    <thead>
      <tr>
        <th>ID</th><th>Name</th><th>Category</th><th>Preview</th><th>URL</th><th></th>
      </tr>
    </thead>
    <tbody>
      {% for icon in icons %}
      <tr>
        <td>{{ icon.id }}</td>
        <td>{{ icon.name }}</td>
        <td>{{ icon.category }}</td>

        <td class="svg_display"><img src="{{icon_url(icon.category, icon.filename)}}" alt="{{ icon.name }}" style="height:32px;"></td>
        <td> {{icon_url(icon.category, icon.filename)}}</td>
        <td class="text-end">
          <a href="{{ url_for('icons.edit', icon_id=icon.id) }}" class="btn btn-sm btn-outline-primary">
            <i class="fa fa-edit"></i> Edit
          </a>
          <form method="post" action="{{ url_for('icons.remove', icon_id=icon.id) }}" class="d-inline" onsubmit="return confirm('Delete icon?');">
            <input type="hidden" name="delete_file" value="1">
            <button class="btn btn-sm btn-outline-danger">
              <i class="fa fa-trash"></i> Delete
            </button>
          </form>
        </td>
      </tr>
      {% else %}
      <tr><td colspan="6" class="text-center text-muted">No icons found.</td></tr>
      {% endfor %}
    </tbody>
  </table>

  {% if pagination.pages > 1 %}
  <nav aria-label="Icons pagination">
    <ul class="pagination">
      <li class="page-item {% if not pagination.has_prev %}disabled{% endif %}">
        <a class="page-link"
           href="{{ url_for('icons.index', q=q, category=category, per_page=per_page, page=pagination.prev_num) }}"
           tabindex="-1" aria-disabled="{{ 'true' if not pagination.has_prev else 'false' }}">
           Previous
        </a>
      </li>

      {# show a compact window of page numbers #}
      {% if start_page > 1 %}
        <li class="page-item">
          <a class="page-link" href="{{ url_for('icons.index', q=q, category=category, per_page=per_page, page=1) }}">1</a>
        </li>
        {% if start_page > 2 %}
          <li class="page-item disabled"><span class="page-link">…</span></li>
        {% endif %}
      {% endif %}

      {% for p in range(start_page, end_page + 1) %}
        <li class="page-item {% if p == pagination.page %}active{% endif %}">
          <a class="page-link" href="{{ url_for('icons.index', q=q, category=category, per_page=per_page, page=p) }}">{{ p }}</a>
        </li>
      {% endfor %}

      {% if end_page < pagination.pages %}
        {% if end_page < pagination.pages - 1 %}
          <li class="page-item disabled"><span class="page-link">…</span></li>
        {% endif %}
        <li class="page-item">
          <a class="page-link" href="{{ url_for('icons.index', q=q, category=category, per_page=per_page, page=pagination.pages) }}">{{ pagination.pages }}</a>
        </li>
      {% endif %}

      <li class="page-item {% if not pagination.has_next %}disabled{% endif %}">
        <a class="page-link"
           href="{{ url_for('icons.index', q=q, category=category, per_page=per_page, page=pagination.next_num) }}">
           Next
        </a>
      </li>
    </ul>
  </nav>
  {% endif %}
</div>
{% endblock %}